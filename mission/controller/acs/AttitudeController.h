/**
 * @author Mikael Senger
 *
 * About: Header file of the AttitudeController class, whose objective it is to
 * manage the attitude of SOURCE and calculate the rotation needed to target a
 * point
 */

#ifndef MISSION_CONTROLLER_ATTITUDECONTROLLER_H_
#define MISSION_CONTROLLER_ATTITUDECONTROLLER_H_

#include <fsfw/action/HasActionsIF.h>
#include <fsfw/action/SimpleActionHelper.h>
#include <fsfw/controller/ExtendedControllerBase.h>
#include <fsfw/health/HealthTableIF.h>
#include <fsfw/parameters/ParameterHelper.h>
#include <fsfw/parameters/ReceivesParameterMessagesIF.h>
#include <mission/controller/acs/helpfunctions/RotationCalc.h>
#include <fsfw/globalfunctions/timevalOperations.h>
#include <OBSWConfig.h>


class AttitudeController: public ExtendedControllerBase {

public:

	AttitudeController(object_id_t objectId);

	virtual ~AttitudeController();

	/* Defining Array size for 3 dimensional vectors and 4 dimensional
	   quaternions */

	static constexpr uint8_t COORDINATES_SIZE = 3;

	static constexpr uint8_t QUATERNION_SIZE = 4;

protected:

	// Guidance algorithm function
	void calcQuatAndRefRot(double *multFactor, timeval currentTime,
			const double *positionF, const double *velocityF,
			double *quatRotPointingAxis, const double *positionTargetF,
			double *quatCurrentAttitude, double *positionTargetI,
			double *quatLastPointing, double *quatBX, double *refRotRate);

	// Sign correction matrix
	int8_t multFactor[QUATERNION_SIZE] { 1, 1, 1, 1 };

	// Creating a RotationCalc object that stores instances of attitude and time
	RotationCalc rotationCalc;

#if OBSW_ACS_TEST == 1
	// only used for testing

	double multFactorTest[50][4] = { { 1, 1, 1, 1 }, { 1, 1, 1, 1 }, { 1, 1, 1,
			1 }, { 1, -1, -1, 1 }, { 1, -1, -1, 1 }, { 1, -1, -1, 1 }, { 1, -1,
			-1, 1 }, { 1, -1, -1, 1 }, { 1, -1, -1, 1 }, { 1, -1, -1, 1 }, { 1,
			-1, -1, 1 }, { 1, -1, -1, 1 }, { 1, -1, -1, 1 }, { 1, -1, -1, 1 }, {
			1, -1, -1, 1 }, { 1, -1, -1, 1 }, { 1, -1, -1, 1 },
			{ 1, -1, -1, 1 }, { 1, -1, -1, 1 }, { 1, -1, 1, 1 },
			{ 1, -1, 1, 1 }, { 1, -1, 1, 1 }, { 1, -1, 1, 1 }, { 1, -1, 1, 1 },
			{ 1, -1, 1, 1 }, { 1, -1, 1, 1 }, { 1, -1, 1, 1 }, { 1, -1, 1, 1 },
			{ 1, -1, 1, 1 }, { 1, -1, 1, 1 }, { 1, -1, 1, 1 }, { 1, -1, 1, 1 },
			{ 1, -1, 1, 1 }, { 1, -1, 1, 1 }, { 1, -1, 1, 1 }, { 1, -1, 1, 1 },
			{ 1, -1, 1, 1 }, { 1, -1, 1, 1 }, { 1, -1, 1, 1 }, { 1, -1, 1, 1 },
			{ 1, -1, 1, 1 }, { 1, -1, 1, 1 }, { 1, -1, 1, 1 }, { 1, -1, 1, 1 },
			{ 1, -1, 1, 1 }, { 1, -1, 1, 1 }, { 1, -1, 1, 1 }, { 1, -1, 1, 1 },
			{ 1, -1, 1, 1 }, { 1, -1, 1, 1 } };

	double currentTimeJDTest[50] = { { 0 }, { 2459640.50041875 }, {
			2459640.50041875 }, { 2459640.50042107 }, { 2459640.50042107 }, {
			2459640.50042338 }, { 2459640.50042338 }, { 2459640.50042569 }, {
			2459640.50042569 }, { 2459640.50042801 }, { 2459640.50042801 }, {
			2459640.50043032 }, { 2459640.50043032 }, { 2459640.50043264 }, {
			2459640.50043264 }, { 2459640.50043495 }, { 2459640.50043495 }, {
			2459640.50043727 }, { 2459640.50043727 }, { 2459640.50043958 }, {
			2459640.50043958 }, { 2459640.5004419 }, { 2459640.5004419 }, {
			2459640.50044421 }, { 2459640.50044421 }, { 2459640.50044653 }, {
			2459640.50044653 }, { 2459640.50044884 }, { 2459640.50044884 }, {
			2459640.50045116 }, { 2459640.50045116 }, { 2459640.50045347 }, {
			2459640.50045347 }, { 2459640.50045579 }, { 2459640.50045579 }, {
			2459640.5004581 }, { 2459640.5004581 }, { 2459640.50046042 }, {
			2459640.50046042 }, { 2459640.50046273 }, { 2459640.50046273 }, {
			2459640.50046505 }, { 2459640.50046505 }, { 2459640.50046736 }, {
			2459640.50046736 }, { 2459640.50046968 }, { 2459640.50046968 }, {
			2459640.50047199 }, { 2459640.50047199 }, { 2459640.50047431 } };

	double positionFTest[50][3] = { { 0, 0, 0 }, { -6366027.80964672,
			-2327009.4498813, 755.222505781426 }, { -6366027.80964672,
			-2327009.4498813, 755.222505781426, }, { -6366152.85679219,
			-2326666.34656749, 2265.64883642406, }, { -6366152.85679219,
			-2326666.34656749, 2265.64883642406, }, { -6366277.56884908,
			-2326323.12097445, 3776.07505026522, }, { -6366277.56884908,
			-2326323.12097445, 3776.07505026522, }, { -6366401.94579417,
			-2325979.77316593, 5286.50106984003, }, { -6366401.94579417,
			-2325979.77316593, 5286.50106984003, }, { -6366525.98763083,
			-2325636.30313294, 6796.92681766867, }, { -6366525.98763083,
			-2325636.30313294, 6796.92681766867, }, { -6366649.69436246,
			-2325292.71086638, 8307.35221607943, }, { -6366649.69436246,
			-2325292.71086638, 8307.35221607943, }, { -6366773.07276831,
			-2324948.9778018, 9817.77718740062, }, { -6366773.07276831,
			-2324948.9778018, 9817.77718740062, }, { -6366896.10923266,
			-2324605.14122241, 11328.2016539605, }, { -6366896.10923266,
			-2324605.14122241, 11328.2016539605, }, { -6367018.81054911,
			-2324261.18252774, 12838.6255380875, }, { -6367018.81054911,
			-2324261.18252774, 12838.6255380875, }, { -6367141.17669453,
			-2323917.10178149, 14349.0487621098, }, { -6367141.17669453,
			-2323917.10178149, 14349.0487621098, }, { -6367263.20767242,
			-2323572.8989746, 15859.4712483559, }, { -6367263.20767242,
			-2323572.8989746, 15859.4712483559, }, { -6367384.90348625,
			-2323228.57409802, 17369.8929191541, }, { -6367384.90348625,
			-2323228.57409802, 17369.8929191541, }, { -6367506.26411298,
			-2322884.12721546, 18880.3136968329, }, { -6367506.26411298,
			-2322884.12721546, 18880.3136968329, }, { -6367627.28952958,
			-2322539.55839065, 20390.7335037206, }, { -6367627.28952958,
			-2322539.55839065, 20390.7335037206, }, { -6367747.97973958,
			-2322194.86761456, 21901.1522621457, }, { -6367747.97973958,
			-2322194.86761456, 21901.1522621457, }, { -6367868.33474654,
			-2321850.05487815, 23411.5698944369, }, { -6367868.33474654,
			-2321850.05487815, 23411.5698944369, }, { -6367988.35451423,
			-2321505.12028156, 24921.9863229225, }, { -6367988.35451423,
			-2321505.12028156, 24921.9863229225, }, { -6368108.03905949,
			-2321160.06377938, 26432.4014699314, }, { -6368108.03905949,
			-2321160.06377938, 26432.4014699314, }, { -6368227.38833287,
			-2320814.88550816, 27942.8152577921, }, { -6368227.38833287,
			-2320814.88550816, 27942.8152577921, }, { -6368346.40236451,
			-2320469.5853861, 29453.2276088333, }, { -6368346.40236451,
			-2320469.5853861, 29453.2276088333, }, { -6368465.08114479,
			-2320124.16344059, 30963.6384453839, }, { -6368465.08114479,
			-2320124.16344059, 30963.6384453839, }, { -6368583.42465083,
			-2319778.61973541, 32474.0476897727, }, { -6368583.42465083,
			-2319778.61973541, 32474.0476897727, }, { -6368701.43285979,
			-2319432.95433438, 33984.4552643286, }, { -6368701.43285979,
			-2319432.95433438, 33984.4552643286, }, { -6368819.10577535,
			-2319087.16722848, 35494.8610913806, }, { -6368819.10577535,
			-2319087.16722848, 35494.8610913806, }, { -6368936.44340121,
			-2318741.25840875, 37005.2650932579 } };

	double velocityFTest[50][3] = { { 0, 0, 0 }, { -626.074312464649,
			1715.21323345253, 7552.13181580142 }, { -626.074312464649,
			1715.21323345253, 7552.13181580142 }, { -624.398894250648,
			1715.82469787132, 7552.13142589865 }, { -624.398894250648,
			1715.82469787132, 7552.13142589865 }, { -622.723426359189,
			1716.43602590089, 7552.13064778664 }, { -622.723426359189,
			1716.43602590089, 7552.13064778664 }, { -621.047908889188,
			1717.04721652629, 7552.12948323507 }, { -621.047908889188,
			1717.04721652629, 7552.12948323507 }, { -619.372341882123,
			1717.65827072302, 7552.12793032496 }, { -619.372341882123,
			1717.65827072302, 7552.12793032496 }, { -617.6967254186,
			1718.26918846159, 7552.12598905632 }, { -617.6967254186,
			1718.26918846159, 7552.12598905632 }, { -616.021054569697,
			1718.87997150782, 7552.12365942918 }, { -616.021054569697,
			1718.87997150782, 7552.12365942918 }, { -614.345339482379,
			1719.49061621908, 7552.1209414436 }, { -614.345339482379,
			1719.49061621908, 7552.1209414436 }, { -612.669575219705,
			1720.10112436964, 7552.11783509966 }, { -612.669575219705,
			1720.10112436964, 7552.11783509966 }, { -610.993761881948,
			1720.71149592305, 7552.11434039744 }, { -610.993761881948,
			1720.71149592305, 7552.11434039744 }, { -609.317899549719,
			1721.32173084984, 7552.11045733706 }, { -609.317899549719,
			1721.32173084984, 7552.11045733706 }, { -607.641988303624,
			1721.93182912054, 7552.10618591867 }, { -607.641988303624,
			1721.93182912054, 7552.10618591867 }, { -605.966028243944,
			1722.54179069871, 7552.1015261424 }, { -605.966028243944,
			1722.54179069871, 7552.1015261424 }, { -604.290019470977,
			1723.15161554797, 7552.09647800844 }, { -604.290019470977,
			1723.15161554797, 7552.09647800844 }, { -602.613962065337,
			1723.76130363885, 7552.09104151699 }, { -602.613962065337,
			1723.76130363885, 7552.09104151699 }, { -600.937856107629,
			1724.37085494187, 7552.08521666826 }, { -600.937856107629,
			1724.37085494187, 7552.08521666826 }, { -599.261701708019,
			1724.98026941726, 7552.07900346248 }, { -599.261701708019,
			1724.98026941726, 7552.07900346248 }, { -597.585498937259,
			1725.58954703898, 7552.07240189992 }, { -597.585498937259,
			1725.58954703898, 7552.07240189992 }, { -595.909247915403,
			1726.1986877639, 7552.06541198084 }, { -595.909247915403,
			1726.1986877639, 7552.06541198084 }, { -594.232948703338,
			1726.80769156937, 7552.05803370556 }, { -594.232948703338,
			1726.80769156937, 7552.05803370556 }, { -592.556601391531,
			1727.41655842253, 7552.05026707438 }, { -592.556601391531,
			1727.41655842253, 7552.05026707438 }, { -590.880206080325,
			1728.02528828709, 7552.04211208764 }, { -590.880206080325,
			1728.02528828709, 7552.04211208764 }, { -589.20376287008,
			1728.63388112685, 7552.0335687457 }, { -589.20376287008,
			1728.63388112685, 7552.0335687457 }, { -587.52727184141,
			1729.24233691236, 7552.02463704894 }, { -587.52727184141,
			1729.24233691236, 7552.02463704894 }, { -585.85073307492,
			1729.85065561415, 7552.01531699775 } };

	double quatRotPointingAxisTest[50][4] = { { 0, 0, 0, 1 }, { 0, 0, 0, 1 }, {
			0, 0, 0, 1 }, { 0, 0, 0, 1 }, { 0, 0, 0, 1 }, { 0, 0, 0, 1 }, { 0,
			0, 0, 1 }, { 0, 0, 0, 1 }, { 0, 0, 0, 1 }, { 0, 0, 0, 1 }, { 0, 0,
			0, 1 }, { 0, 0, 0, 1 }, { 0, 0, 0, 1 }, { 0, 0, 0, 1 },
			{ 0, 0, 0, 1 }, { 0, 0, 0, 1 }, { 0, 0, 0, 1 }, { 0, 0, 0, 1 }, { 0,
					0, 0, 1 }, { 0, 0, 0, 1 }, { 0, 0, 0, 1 }, { 0, 0, 0, 1 }, {
					0, 0, 0, 1 }, { 0, 0, 0, 1 }, { 0, 0, 0, 1 },
			{ 0, 0, 0, 1 }, { 0, 0, 0, 1 }, { 0, 0, 0, 1 }, { 0, 0, 0, 1 }, { 0,
					0, 0, 1 }, { 0, 0, 0, 1 }, { 0, 0, 0, 1 }, { 0, 0, 0, 1 }, {
					0, 0, 0, 1 }, { 0, 0, 0, 1 }, { 0, 0, 0, 1 },
			{ 0, 0, 0, 1 }, { 0, 0, 0, 1 }, { 0, 0, 0, 1 }, { 0, 0, 0, 1 }, { 0,
					0, 0, 1 }, { 0, 0, 0, 1 }, { 0, 0, 0, 1 }, { 0, 0, 0, 1 }, {
					0, 0, 0, 1 }, { 0, 0, 0, 1 }, { 0, 0, 0, 1 },
			{ 0, 0, 0, 1 }, { 0, 0, 0, 1 }, { 0, 0, 0, 1 } };

	double positionTargetFTest[50][3] = { { 0, 0, 0 }, { 0, 0, 0 }, { 0, 0, 0 },
			{ 0, 0, 0 }, { 0, 0, 0 }, { 0, 0, 0 }, { 0, 0, 0 }, { 0, 0, 0 }, {
					0, 0, 0 }, { 0, 0, 0 }, { 0, 0, 0 }, { 0, 0, 0 },
			{ 0, 0, 0 }, { 0, 0, 0 }, { 0, 0, 0 }, { 0, 0, 0 }, { 0, 0, 0 }, {
					0, 0, 0 }, { 0, 0, 0 }, { 0, 0, 0 }, { 0, 0, 0 },
			{ 0, 0, 0 }, { 0, 0, 0 }, { 0, 0, 0 }, { 0, 0, 0 }, { 0, 0, 0 }, {
					0, 0, 0 }, { 0, 0, 0 }, { 0, 0, 0 }, { 0, 0, 0 },
			{ 0, 0, 0 }, { 0, 0, 0 }, { 0, 0, 0 }, { 0, 0, 0 }, { 0, 0, 0 }, {
					0, 0, 0 }, { 0, 0, 0 }, { 0, 0, 0 }, { 0, 0, 0 },
			{ 0, 0, 0 }, { 0, 0, 0 }, { 0, 0, 0 }, { 0, 0, 0 }, { 0, 0, 0 }, {
					0, 0, 0 }, { 0, 0, 0 }, { 0, 0, 0 }, { 0, 0, 0 },
			{ 0, 0, 0 }, { 0, 0, 0 } };

	double quatCurrentAttitudeTest[50][4] = { { 0, 0, 0, 0 }, {
			1.38159991922785e-07, -6.68420269660349E-07, 2.07189816508101E-07,
			0.999999999999746 }, { 1.38159991922785E-07, -6.68420269660349E-07,
			2.07189816508101E-07, 0.999999999999746 }, { 0.000149636115372118,
			-0.000723141228111279, 0.000225688562680129, 0.999999701870191 }, {
			0.000149636115372118, -0.000723141228111279, 0.000225688562680129,
			0.999999701870191 }, { 0.000852054274934002, -0.00408402155883108,
			0.00130619659489244, 0.999990444265281 }, { 0.000852054274934002,
			-0.00408402155883108, 0.00130619659489244, 0.999990444265281 }, {
			0.00229916241361453, -0.0108424047579871, 0.00365505968480084,
			0.999931896005903 }, { 0.00229916241361453, -0.0108424047579871,
			0.00365505968480084, 0.999931896005903 }, { 0.00433795898635959,
			-0.0199782841522756, 0.00733843086936923, 0.999764071022029 }, {
			0.00433795898635959, -0.0199782841522756, 0.00733843086936923,
			0.999764071022029 }, { 0.00659447102419381, -0.0294958140881392,
			0.0121967309240537, 0.999468733707041 }, { 0.00659447102419381,
			-0.0294958140881392, 0.0121967309240537, 0.999468733707041 }, {
			0.0087306767059732, -0.0377865295032454, 0.0180628581029278,
			0.999084424175209 }, { 0.0087306767059732, -0.0377865295032454,
			0.0180628581029278, 0.999084424175209 }, { 0.0105819586400738,
			-0.0441759144397875, 0.0248408119360979, 0.998658823020707 }, {
			0.0105819586400738, -0.0441759144397875, 0.0248408119360979,
			0.998658823020707 }, { 0.0121274771804528, -0.0486747214482933,
			0.0324536143701184, 0.998213633799642 }, { 0.0121274771804528,
			-0.0486747214482933, 0.0324536143701184, 0.998213633799642 }, {
			0.0134110402489343, -0.0515889597714249, 0.0407818445322319,
			0.997745240222018 }, { 0.0134110402489343, -0.0515889597714249,
			0.0407818445322319, 0.997745240222018 }, { 0.0144870280558735,
			-0.0532829116946977, 0.0496447661318613, 0.997239416857936 }, {
			0.0144870280558735, -0.0532829116946977, 0.0496447661318613,
			0.997239416857936 }, { 0.0153986405437306, -0.05408348553311,
			0.058816496066017, 0.99668374033718 }, { 0.0153986405437306,
			-0.05408348553311, 0.058816496066017, 0.99668374033718 }, {
			0.0161745440039779, -0.0542554944052037, 0.0680567977564741,
			0.996073791308779 }, { 0.0161745440039779, -0.0542554944052037,
			0.0680567977564741, 0.996073791308779 }, { 0.0168323952637341,
			-0.0540032980344212, 0.0771411907687073, 0.995414260977748 }, {
			0.0168323952637341, -0.0540032980344212, 0.0771411907687073,
			0.995414260977748 }, { 0.0173834303987042, -0.0534797745493242,
			0.0858823800901878, 0.99471701847901 }, { 0.0173834303987042,
			-0.0534797745493242, 0.0858823800901878, 0.99471701847901 }, {
			0.017835983362261, -0.0527961696128515, 0.0941407922104622,
			0.993997964491728 }, { 0.017835983362261, -0.0527961696128515,
			0.0941407922104622, 0.993997964491728 }, { 0.0181975581868659,
			-0.0520310489105541, 0.101825659581607, 0.993273957111568 }, {
			0.0181975581868659, -0.0520310489105541, 0.101825659581607,
			0.993273957111568 }, { 0.0184757465795742, -0.0512379782435248,
			0.108889721654925, 0.992560499360999 }, { 0.0184757465795742,
			-0.0512379782435248, 0.108889721654925, 0.992560499360999 }, {
			0.0186784242070561, -0.0504519041580968, 0.115320714929789,
			0.991870381927017 }, { 0.0186784242070561, -0.0504519041580968,
			0.115320714929789, 0.991870381927017 }, { 0.0188136234172351,
			-0.0496942116215822, 0.121132449186764, 0.991213126758943 }, {
			0.0188136234172351, -0.0496942116215822, 0.121132449186764,
			0.991213126758943 }, { 0.018889250339557, -0.0489767546786722,
			0.126356282977655, 0.990595055244486 }, { 0.018889250339557,
			-0.0489767546786722, 0.126356282977655, 0.990595055244486 }, {
			0.018912744536031, -0.0483051013382044, 0.131033324815018,
			0.990019794280267 }, { 0.018912744536031, -0.0483051013382044,
			0.131033324815018, 0.990019794280267 }, { 0.0188909568879541,
			-0.0476805972767515, 0.135209789512883, 0.989488759517293 }, {
			0.0188909568879541, -0.0476805972767515, 0.135209789512883,
			0.989488759517293 }, { 0.0188300425902226, -0.0471019476382523,
			0.138933278811948, 0.989001708827288 }, { 0.0188300425902226,
			-0.0471019476382523, 0.138933278811948, 0.989001708827288 }, {
			0.0187354223627469, -0.0465663130657081, 0.142250317195295,
			0.988557236428015 } };

	double quatLastPointingTest[50][4] = {
	{ 0, 0, 0, 1 },
	{ 0, 0, 0, 1 },
	{ 0, 0, 0, 1 },
	{ 0.996192286201972, -0.00253193611993782, -0.000789664059530919, 0.0871429552049187 },
	{ 0.996192286201972, -0.00253193611993782, -0.000789664059530919, 0.0871429552049187 },
	{ 0.996192373669868, -0.00254179541911569, -0.000676954897577316, 0.0871426167274591 },
	{ 0.996192373669868, -0.00254179541911569, -0.000676954897577316, 0.0871426167274591 },
	{ 0.996192448384281, -0.00255165469645879, -0.000564245728041901, 0.0871422771517965 },
	{ 0.996192448384281, -0.00255165469645879, -0.000564245728041901, 0.0871422771517965 },
	{ 0.996192510352134, -0.0025615139380771, -0.000451536553757774, 0.0871419363991833 },
	{ 0.996192510352134, -0.0025615139380771, -0.000451536553757774, 0.0871419363991833 },
	{ 0.99619255956633, -0.00257137314311125, -0.000338827376017132, 0.0871415945507844 },
	{ 0.99619255956633, -0.00257137314311125, -0.000338827376017132, 0.0871415945507844 },
	{ 0.996192596026844, -0.002581232321527, -0.000226118195381445, 0.0871412516065846 },
	{ 0.996192596026844, -0.002581232321527, -0.000226118195381445, 0.0871412516065846 },
	{ 0.996192619730181, -0.00259109292044405, -0.000113408886662472, 0.087140907563672 },
	{ 0.996192619730181, -0.00259109292044405, -0.000113408886662472, 0.087140907563672 },
	{ 0.996192630683359, -0.00260095202867197, -6.99706020756002E-07, 0.0871405624277428 },
	{ 0.996192630683359, -0.00260095202867197, -6.99706020756002E-07, 0.0871405624277428 },
	{ 0.996192628882873, -0.00261081110342533, 0.000112009472615687, 0.0871402161960319 },
	{ 0.996192628882873, -0.00261081110342533, 0.000112009472615687, 0.0871402161960319 },
	{ 0.996192614328721, -0.0026206701453529, 0.000224718647870157, 0.0871398688685401 },
	{ 0.996192614328721, -0.0026206701453529, 0.000224718647870157, 0.0871398688685401 },
	{ 0.996192587020916, -0.00263052914992476, 0.000337427817912823, 0.0871395204452807 },
	{ 0.996192587020916, -0.00263052914992476, 0.000337427817912823, 0.0871395204452807 },
	{ 0.996192546959434, -0.00264038812710657, 0.000450136982182194, 0.0871391709262314 },
	{ 0.996192546959434, -0.00264038812710657, 0.000450136982182194, 0.0871391709262314 },
	{ 0.996192494144302, -0.00265024706667521, 0.000562846138350302, 0.08713882031142 },
	{ 0.996192494144302, -0.00265024706667521, 0.000562846138350302, 0.08713882031142 },
	{ 0.996192428575518, -0.00266010596927987, 0.000675555285040486, 0.0871384686008483 },
	{ 0.996192428575518, -0.00266010596927987, 0.000675555285040486, 0.0871384686008483 },
	{ 0.996192350253069, -0.00266996484126215, 0.00078826442137415, 0.087138115794501 },
	{ 0.996192350253069, -0.00266996484126215, 0.00078826442137415, 0.087138115794501 },
	{ 0.996192259176967, -0.0026798236780919, 0.000900973545521453, 0.0871377618923931 },
	{ 0.996192259176967, -0.0026798236780919, 0.000900973545521453, 0.0871377618923931 },
	{ 0.99619215534722, -0.00268968247757151, 0.00101368265585665, 0.0871374068945341 },
	{ 0.99619215534722, -0.00268968247757151, 0.00101368265585665, 0.0871374068945341 },
	{ 0.996192038763816, -0.00269954124526553, 0.00112639175143316, 0.0871370508009094 },
	{ 0.996192038763816, -0.00269954124526553, 0.00112639175143316, 0.0871370508009094 },
	{ 0.996191909426768, -0.00270939997613013, 0.00123910083037619, 0.0871366936115373 },
	{ 0.996191909426768, -0.00270939997613013, 0.00123910083037619, 0.0871366936115373 },
	{ 0.996191767336078, -0.00271925867132768, 0.00135180989135399, 0.0871363353264169 },
	{ 0.996191767336078, -0.00271925867132768, 0.00135180989135399, 0.0871363353264169 },
	{ 0.996191612491728, -0.00272911733797783, 0.00146451893355603, 0.0871359759455254 },
	{ 0.996191612491728, -0.00272911733797783, 0.00146451893355603, 0.0871359759455254 },
	{ 0.996191444893748, -0.00273897596585719, 0.00157722795465434, 0.0871356154689011 },
	{ 0.996191444893748, -0.00273897596585719, 0.00157722795465434, 0.0871356154689011 },
	{ 0.996191264542148, -0.00274883455199077, 0.00168993695295519, 0.087135253896559 },
	{ 0.996191264542148, -0.00274883455199077, 0.00168993695295519, 0.087135253896559 },
	{ 0.996191071436895, -0.00275869310996896, 0.00180264592821418, 0.0871348912284502 }};

	double positionTargetITest[3];
	double quatBXTest[4];
	double refRotRateTest[3];

#endif

private:

	// TODO: Add stubs for thermal components. Each device / assembly with one
	// or multiple redundant sensors will have a thermal component.

	/** ExtendedControllerBase overrides */
	virtual ReturnValue_t handleCommandMessage(CommandMessage *message)
			override;

	virtual void performControlOperation() override;

	virtual ReturnValue_t checkModeCommand(Mode_t mode, Submode_t submode,
			uint32_t *msToReachTheMode) override;

	virtual ReturnValue_t initializeLocalDataPool(
			localpool::DataPool &localDataPoolMap,
			LocalDataPoolManager &poolManager) override;
	virtual LocalPoolDataSetBase* getDataSetHandle(sid_t sid) override;

	ReturnValue_t initializeAfterTaskCreation() override;

	void handleChangedDataset(sid_t sid, store_address_t storeId =
			storeId::INVALID_STORE_ADDRESS, bool *clearMessage = nullptr)
			override;


	double lastRefRotRate[COORDINATES_SIZE] { 0, 0, 0 };
};

/* Information about variables of the guidance algorithm
 typedef struct input{
 double multFactor[QUATERNION_SIZE];
 / sign correction /
 double timeJulianDateUT1;
 double positionF[COORDINATES_SIZE];
 / F: ECEF (earth-centered, earth-fixed) coordinate system /
 double velocityF[COORDINATES_SIZE];
 double quatRotPointingAxis[QUATERNION_SIZE];
 / quatRef /
 double positionTargetF[COORDINATES_SIZE];
 double quatCurrentAttitude[QUATERNION_SIZE];
 / quatBI /
 double quatLastPointing[QUATERNION_SIZE];
 / quatIX /
 double timeLastPointing;
 }Input;

 typedef struct output{
 double quatBX[QUATERNION_SIZE];
 / B: Body coordinate System X:Target coordinate System /
 double rotRateRef[COORDINATES_SIZE];
 double quatCurrentPointing[QUATERNION_SIZE];
 / quatIX /
 double timeCurrentPointing;
 double multFactor[QUATERNION_SIZE];
 double quatIX[QUATERNION_SIZE];
 / I: ECI (earth-centered inertial) coordinate system /
 double positionTargetI[COORDINATES_SIZE];
 double vectorOppToTargetI[COORDINATES_SIZE];
 }Output;
 */

#endif /* MISSION_CONTROLLER_ATTITUDECONTROLLER_H_ */
